
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>飞机订票系统</title>
    <link href="~/Content/images/log.png" type="image/x-icon" rel="shortcut icon" />
    <link href="~/Content/layui/css/layui.css" rel="stylesheet" />
    <!--bootstrap 框架样式表-->
    <link href="~/Content/bootstrap-4.1.3-dist/css/bootstrap.min.css" rel="stylesheet" />
    <!--后台模板中的字体图标css样式-->
    <link href="~/Content/app-assets/fonts/feather/style.min.css" rel="stylesheet" />
    <link href="~/Content/app-assets/fonts/simple-line-icons/style.min.css" rel="stylesheet" />
    <!--系统维护样式表-->
    <link href="~/Content/css/SystemMaintenance.css" rel="stylesheet" />
    <style>
        div{
            font-family: "华文彩云";
        }
        h4{
            font-family: "华文彩云";
        }
        h5{
            font-family: "华文彩云";
        }
        p{
            font-family: "华文彩云";
        }
         label{
            font-family: "华文彩云";
        }
        input{
            font-family: "华文彩云";
        }
        tr{
            font-family: "华文彩云";
        }
        td{
            font-family: "华文彩云";
        }
        th{
            font-family: "华文彩云";
        }
        b{
            font-family: "华文彩云";
        }
        button{
            font-family: "华文彩云";
        }
        a{
            font-family: "华文彩云";
        }
        h2{
            font-family: "华文彩云";
        }
        dd{
            font-family: "华文彩云";
        }
        span{
            font-family: "华文彩云";
        }
        select{
            font-family: "华文彩云";
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <h3 class="text-center py-3">票 号 维 护</h3>
        <div class="pb-3">
            @*table*@
            <table id="tabTicket" lay-filter="tabTicket"></table>

            <p class="text-muted text-center my-4">中国东方航空·China Eastern Airlines</p>
            <div class="row">
                <div class="col-12 text-center">
                    <button type="button" class="btn btn-outline-primary" onclick="GoInsertTicket()">新增请前往票证下发</button>
                </div>
            </div>
        </div>
    </div>
    <script src="~/Content/js/jquery-3.2.1.min.js"></script>
    <script src="~/Content/bootstrap-4.1.3-dist/js/bootstrap.min.js"></script>
    <script src="~/Content/layui/layui.js"></script>
    <script src="~/Content/js/customfunction.js"></script>
    <script>
        var layer, layuiTable;
        var tabTicket;

        $(function () {
            layui.use(['layer', 'table'], function () {
                layer = layui.layer;
                layuiTable = layui.table;
                //表格的初始化
                tabTicket = layuiTable.render({
                    elem: "#tabTicket", //table的ID HTML元素的ID
                    url: "@Url.Content("~/SystemMaintenance/TicketNumMaintain/SelectTicket")",
                    cols: [
                        [
                            { title: '序号', type: 'numbers' }, //序号列，title设定标题名称
                            { title: '开始票号', field: 'strStartTicketNo', align: 'center' },
                            { title: '结束票号', field: 'strEndTicketNo', align: 'center' },
                            { title: '当前票号', field: 'strCurrentTicketNo', align: 'center' },
                            { title: '日期', field: 'strTicketDate', align: 'center' },
                            { title: '用户组号', field: 'userGroupNumber', align: 'center' },
                            { title: '用户工号', field: 'jobNumber', align: 'center' },
                            { title: '用户姓名', field: 'userName', align: 'center' },
                            { title: '操作', templet: customOp, align: 'center' }
                        ]
                    ],
                    page: {
                        limit: 6, //指定每页显示的条数
                        limits: [5, 10, 15, 20, 25, 30, 35, 40, 45, 50], //每页条数的选择项
                    }, //开启分页
                });
                //第一次加载表格数据
                searchTabTicket();
            });
        });
        function customOp(rowData) {
            var isEnable = rowData.isEnable;
            var ticketID = rowData.ticketID;
            var strHtml = "";
            if (isEnable) {
                strHtml += '<button type="button" class="layui-btn layui-btn-warm layui-btn-xs" onclick="switchTitcketEnable(' + ticketID + ',false)">禁用</button>';
            } else {
                strHtml += '<button type="button" class="layui-btn layui-btn-normal layui-btn-xs" onclick="switchTitcketEnable(' + ticketID + ',true)">启用</button>';
            }
            //删除
            strHtml += '<button type="button" class="layui-btn layui-btn-danger layui-btn-xs" onclick="deleteTicket(' + ticketID + ')">删除</button>';

            return strHtml;
        }
        //启用和禁用
        function switchTitcketEnable(ticketID, isEnable) {
            var tip = "您确认要" + (isEnable ? "启用" : "禁用") + "该票号段吗?";
            layer.confirm(tip, { icon: 3, title: '提示' }, function (index) {
                layer.close(index);
                //打开加载层
                var layerIndex = layer.load();
                //请求
                $.post("@Url.Content("~/SystemMaintenance/TicketNumMaintain/SwitchTitcketEnable")",
                    {
                        ticketID: ticketID,
                        isEnable: isEnable,
                    },
                    function (msg) {
                        //关闭加载层
                        layer.close(layerIndex);
                        if (msg.State) {
                            //刷新table
                            tabTicket.reload();

                            //layer.alert(msg.Text, { icon: 1 });
                            myAlert(msg.Text, "提示", 1);
                        } else {
                            //layer.alert(msg.Text, { icon: 2 });
                            myAlert(msg.Text, "提示", 2);
                        }
                    }
                );
            });
        }
        //删除
        function deleteTicket(ticketID) {
            var tip = "您确认要删除该票号段吗?";
            layer.confirm(tip, { icon: 3, title: '提示' }, function (index) {
                layer.close(index);
                //打开加载层
                var layerIndex = layer.load();
                //请求
                $.post("@Url.Content("~/SystemMaintenance/TicketNumMaintain/DeleteTicket")",
                    {
                        ticketID: ticketID
                    },
                    function (msg) {
                        //关闭加载层
                        layer.close(layerIndex);
                        if (msg.State) {
                            //刷新table,回到第一页
                            tabTicket.reload({
                                page: {
                                    curr: 1 //重新从第 1 页开始
                                }
                            });

                            //layer.alert(msg.Text, { icon: 1 });
                            myAlert(msg.Text, "提示", 1);
                        } else {
                            //layer.alert(msg.Text, { icon: 2 });
                            myAlert(msg.Text, "提示", 2);
                        }
                    }
                );
            });
        }
    </script>
</body>
</html>
